<mat-toolbar class="expanded-toolbar">
    <span>
      <button mat-button routerLink="/"><mat-icon>home</mat-icon></button>
    </span>



  <div fxLayout="row" fxShow="false" fxShow.gt-sm>









<ng-container class="tab">
  <table >
    <tr>
      <td>
        <section *ngIf="authService.isAuthenticated">
          <mat-icon>person</mat-icon>
          <b>{{authService.name}}</b>
        </section>
      </td>
      <td>
        <button mat-button *ngIf="!authService.isAuthenticated" (click)="add()">
          <mat-icon>person_add</mat-icon>
          Register
        </button>
      </td>
      <td>
        <ng-container *ngIf="this.pl.boardGame.state > 0">
          <button mat-button (click)="reset()" >
            <mat-icon>delete_sweep</mat-icon>
            Reset Game
          </button>

        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="(!this.pl.boardGame.state || (this.pl.boardGame.state) == 0) && this.pl.boardGame.players && this.pl.boardGame.players.total > 0">
          <button mat-button (click)="create()" >
            <mat-icon>gamepad</mat-icon>
            Start Game
          </button>

        </ng-container>
      </td>
      <td>
        <ng-container *ngIf="authService.isAuthenticated">
          <button mat-button (click)="logout()">
            <mat-icon>exit_to_app</mat-icon>
            Logout
          </button>

        </ng-container>
      </td>
      <td>
        <div  *ngIf= "(this.pl.boardGame.state && (this.pl.boardGame.state) != 0)" mat-card-avatar style="width: 60px; height: 60px;" class='{{this.pl.boardGame.secrets.character }}'></div>
      </td>
      <td>
        <ng-container  *ngIf= "(this.pl.boardGame.state && (this.pl.boardGame.state) != 0)"  style="font-size: 16px;" >
          <b> {{this.pl.boardGame.secrets.character}}, your secrets: {{this.pl.boardGame.secrets.secrets }} &nbsp;&nbsp;&nbsp;</b>
        </ng-container>
      </td>
      <td *ngIf= "(this.pl.boardGame.state && (this.pl.boardGame.state) != 0)">
        Others:
      </td>

        <ng-container *ngFor="let ch of this.pl.boardGame.characters">
          <td>
          <div  mat-card-avatar style="width: 30px; height: 30px;" class='{{ch}}' *ngIf= "(this.pl.boardGame.state && (this.pl.boardGame.state) != 0) && this.pl.boardGame.secrets.character != ch">
          </div>
          </td>
        </ng-container>

    </tr>
  </table>

</ng-container>




  </div>

</mat-toolbar>

<div class="signin-content" *ngIf="!authService.isAuthenticated">
  <mat-card>
    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="login()">
        <p>Please login to continue</p>
        <mat-form-field class="full-width-input">
          <input matInput placeholder="User" formControlName="username" required>
        </mat-form-field>
        <mat-form-field class="full-width-input">
          <input matInput type="password" placeholder="Password" formControlName="password" required>
        </mat-form-field>
        <button mat-raised-button color="primary" type="submit">Login</button>
      </form>
    </mat-card-content>
  </mat-card>
</div>













<div [ngStyle]="{background: 'assets/background.jfif', 'background-attachment': 'fixed', 'background-repeat': 'no-repeat'}" class="app-content">
  <div>
<br>
    <div *ngIf="this.pl.boardGame && this.pl.boardGame.suggester && (this.pl.boardGame.state && ((this.pl.boardGame.state) == 1 || (this.pl.boardGame.state) == 4)) && this.authService.name === this.pl.boardGame.suggester" class='div-orw'>

      <mat-card  class='div-orw'>
        <mat-card-header>
          <mat-card-title>{{this.authService.name}}, Please Suggest {{this.pl.boardGame.results[this.pl.boardGame.current].numofplayers}} Players For Next Quest</mat-card-title>
        </mat-card-header>
        <mat-card-content>

          <ng-container *ngFor="let player of this.pl.boardGame.players.all">

            <input [(ngModel)]="player.ch" type="checkbox" [disabled]="!player.ch && maxNo" (change)="onChange($event.target.checked)">{{player.player}}

          </ng-container>
          <button *ngIf="maxNo" mat-button (click)="Suggest()">Send</button>



        </mat-card-content>
      </mat-card>
    </div>

    <p></p>
    <div *ngIf="this.pl.boardGame && this.pl.boardGame.suggester != null && (this.pl.boardGame.state && ((this.pl.boardGame.state) == 1 || (this.pl.boardGame.state) == 4)) && this.authService.name != this.pl.boardGame.suggester" class='div-orw'>
      <mat-card  class='div-orw'>
        <mat-card-header>
          <mat-card-title>Please wait while {{this.pl.boardGame.suggester}} is choosing the next quest!</mat-card-title>
        </mat-card-header>

      </mat-card>
    </div>






    <p></p>
    <div *ngIf="(this.pl.boardGame.state && (this.pl.boardGame.state) == 2) && this.pl.showSuggestion " class='div-orw'>
      <mat-card  class='div-orw'>
        <mat-card-header>
          <mat-card-title>{{this.pl.boardGame.suggester}} suggested on:
            <ng-container *ngFor="let player of this.pl.boardGame.suggestedPlayers">
              {{player}}
            </ng-container>

          </mat-card-title>
        </mat-card-header>
        <mat-card-content>

          <button mat-mini-fab class="div-yes" (click)="SendGoodVote()"><mat-icon>thumb_up</mat-icon></button>

          <button class="div-no" mat-mini-fab (click)="SendBadVote()"><mat-icon>thumb_down</mat-icon></button>

        </mat-card-content>
      </mat-card>
    </div>


    <p></p>





    <p></p>
    <div *ngIf="(this.pl.boardGame.state && (this.pl.boardGame.state) == 3) && this.pl.boardGame.suggestedPlayers.includes(this.player) && (!this.pl.boardGame.PlayersVotedForCurrQuest || !this.pl.boardGame.PlayersVotedForCurrQuest.includes(this.player))" class='div-orw'>
      <mat-card  class='div-orw'>
        <mat-card-header>
          <mat-card-title>Vote For Quest!</mat-card-title>
        </mat-card-header>

        <mat-radio-group aria-label="Select an option" [(ngModel)] = "journeyVote.vote">

            <ng-container>
              <mat-radio-button type="radio" name="success" value=1 display="none" id="pp" [disabled]="!this.pl.boardGame.optionalVotes.includes('Success')">
                <label for="pp">
                  <img src="./assets/Success_vote.png" width="120px"/>
                </label>
              </mat-radio-button>
            </ng-container>


            <ng-container>
              <mat-radio-button type="radio" name="reversal" value=2 display="none" id="pp2" [disabled]="!this.pl.boardGame.optionalVotes.includes('Reversal')">
                <label for="pp2">

                  <img src="./assets/Reversal_vote.png" width="120px"/>
                </label>
              </mat-radio-button>
            </ng-container>


            <ng-container>
              <mat-radio-button type="radio" name="fail" value=0 display="none" id="pp3" [disabled]="!this.pl.boardGame.optionalVotes.includes('Fail')">
                <label for="pp3">

                  <img src="./assets/Fail_vote.png" width="120px"/>
                </label>
              </mat-radio-button>
            </ng-container>

          <p><button mat-button (click)="JourneyVote()">Vote!</button></p>

        </mat-radio-group>
      </mat-card>

    </div>














    <div id="serviceBox" *ngIf="this.pl.boardGame.players && this.pl.boardGame.players.total > 0">
      <div class="serviceBox1">
        <div  class="bla">
          <mat-card class=''>
            <mat-card-title>Room Table</mat-card-title>
            <mat-card-content>
              {{ this.pl.boardGame.players.total }} Players
              <mat-list>
                <mat-list-item *ngFor="let player of this.pl.boardGame.players.all">


                  <mat-icon matListIcon>person</mat-icon>
                  <h3 matLine> {{player.player}} </h3>

                  <ng-container *ngIf="this.pl.boardGame && (this.pl.boardGame.suggesterVeto == player.player)">
                    <img src="./assets/hammer.png" width="15px"/>

                  </ng-container>

                  <mat-icon matListIcon [ngStyle]="{'color':'blue'}" *ngIf="this.pl.boardGame && (this.pl.boardGame.state ==1 || this.pl.boardGame.state ==3) &&  this.pl.boardGame.PlayersVotedYesForSuggestion && this.pl.boardGame.PlayersVotedYesForSuggestion.includes(player.player); else downn">thumb_up</mat-icon>

                  <ng-template #downn>
                    <mat-icon matListIcon [ngStyle]="{'color':'red'}" *ngIf="this.pl.boardGame && (this.pl.boardGame.state ==1 || this.pl.boardGame.state ==3) && this.pl.boardGame.PlayersVotedNoForSuggestion && this.pl.boardGame.PlayersVotedNoForSuggestion.includes(player.player); else typing">thumb_down</mat-icon>
                  </ng-template>

                  <ng-template #typing>
                    <mat-icon matListIcon *ngIf="this.pl.boardGame.state == 2 && ((!this.pl.boardGame.PlayersVotedYesForSuggestion || !this.pl.boardGame.PlayersVotedYesForSuggestion.includes(player.player)) && (!this.pl.boardGame.PlayersVotedNoForSuggestion || !this.pl.boardGame.PlayersVotedNoForSuggestion.includes(player.player))); else done">textsms</mat-icon>
                  </ng-template>

                  <ng-template #done>
                    <mat-icon matListIcon *ngIf="this.pl.boardGame.state == 2 ">done</mat-icon>
                  </ng-template>

                  <mat-icon matListIcon [ngStyle]="{'color':'black'}" *ngIf="this.pl.boardGame && this.pl.boardGame.suggestedPlayers && this.pl.boardGame.suggestedPlayers.includes(player.player) && (this.pl.boardGame.state == 3 || this.pl.boardGame.state == 2)">directions_walk</mat-icon>
                </mat-list-item>
              </mat-list>
            </mat-card-content>

          </mat-card>
        </div>
      </div>

      <div  class="serviceBox2" *ngIf="this.pl.boardGame.players.total > 0 && this.pl.boardGame.state > 0 && this.pl.boardGame.results != null">
        <div class="ddd">

          <mat-grid-list class="dddw" cols="7" rowHeight="170px" gutterSize="5px">

            <ng-container *ngFor="let quest of this.pl.boardGame.results | keyvalue">


              <mat-grid-tile [ngStyle]="{'font-size': '6px'}">
                <div class="container">

                  <mat-card class="dddw">
                    <mat-card-header class="dddww">
                      <mat-card-title class="dddww2">Quest {{quest.key}}</mat-card-title>
                      <mat-card-subtitle class="dddww" *ngIf="quest.value.ppp == '1'">Regular</mat-card-subtitle>
                      <mat-card-subtitle class="dddww" *ngIf="quest.value.ppp == '2'">Flush</mat-card-subtitle>
                      <mat-card-subtitle class="dddww" *ngIf="quest.value.ppp == '3'">Two Fails</mat-card-subtitle>
                    </mat-card-header>

                    <mat-card-content [ngStyle]="{'font-size': '8px'}">
                      <ng-container *ngIf="!quest.value.final">
                        <img src="./assets/none-{{quest.value.numofplayers}}.png"
                        />

                      </ng-container>
                      <ng-container *ngIf="quest.value.final == 1">
                        <img src="./assets/fail.png" alt=' {{quest.value.failures}} " Fails, " {{quest.value.successes}} "Success, " {{quest.value.reversals}} "Reversal"'
                             title=' {{quest.value.failures}} " Fails, " {{quest.value.successes}} "Success, " {{quest.value.reversals}} "Reversal"'/>

                      </ng-container>

                      <ng-container *ngIf="quest.value.final == 2">
                        <img src="./assets/success.png" alt=' {{quest.value.failures}} " Fails, " {{quest.value.successes}} "Success, " {{quest.value.reversals}} "Reversal"'
                             title=' {{quest.value.failures}} " Fails, " {{quest.value.successes}} "Success, " {{quest.value.reversals}} "Reversal"'/>

                      </ng-container>

                    </mat-card-content>
                  </mat-card>
                </div>
              </mat-grid-tile>


            </ng-container>



























          </mat-grid-list>




        </div>
      </div>


    </div>



    <br>
    <br>
    <div>

      <table *ngIf="this.pl.boardGame.archive && this.pl.boardGame.state != 0" class="xxss">
        <tr class="xxssw">
          <td class="xxssw">Player</td>

          <td class="xxssw" *ngFor="let player of this.pl.boardGame.players.all">
            {{ player.player | limitTo: "10" }}

          </td>

          <td class="xxssw">Failures</td>

          <td class="xxssw">Reversal</td>

          <td class="xxssw">Succeses</td>
        </tr>

        <ng-container *ngFor="let questItem of this.pl.boardGame.archive" >
          <tr class="xxssw" [hidden]='(this.pl.boardGame.current != (questItem.questId | round)) && !questItem.isSuggestionAccepted && this.filterqu[questItem.questId | round]'>
            <td class="xxssw" (click)="FilterQuests(questItem.questId)" >{{questItem.questId}}</td>

            <ng-container *ngFor="let player of this.pl.boardGame.players.all">


            <td [ngClass]="{'green' : questItem.playersAcceptedQuest && questItem.playersAcceptedQuest.includes(player.player), 'red': questItem.playersNotAcceptedQuest && questItem.playersNotAcceptedQuest.includes(player.player)}" class="xxssw">
              <div>

                <ng-container *ngIf="questItem.suggestedPlayers.includes(player.player)">
                  <img src="./assets/sword3.png" width="15px"/>
                </ng-container>

                <ng-container *ngIf="questItem.suggester.player == player.player">
                  <img src="./assets/leader.png" width="15px"/>
                </ng-container>

              </div></td>

            </ng-container>

            <td class="xxssw">
              <div>
                {{questItem.numberOfFailures}}
              </div>
            </td>

            <td class="xxssw">
              <div>
                {{questItem.numberOfReversal}}
              </div>
            </td>


            <td class="xxssw">
              <div>
                {{questItem.numberOfSuccesses}}
              </div>
            </td>
          </tr></ng-container>


      </table>


    </div>


  </div>
</div>
